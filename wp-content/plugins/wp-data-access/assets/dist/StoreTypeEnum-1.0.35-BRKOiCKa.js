import{l as t,aQ as Pe,aA as Se,A,aw as f,p as L,aR as B,aS as he,aT as Ne,aU as Ae,b as Te,av as Y,aV as G,ax as Ce,ay as de,a4 as _e,aW as De,S as Ie,aN as xe,an as Je,aX as Re,aY as we,aZ as Ee,az as Fe}from"./lib-1.0.35-vCbYWOI3.js";import{a as Ue}from"./RestApi-1.0.35-Bt-tzntO.js";const Me=(c,R)=>({app_id:c,cnt_id:R}),Ve=(c,R)=>({dbs:c,tbl:R}),Ge=(c,R)=>{t.debug(c,R);const v=Ue(),Oe=(i,u,e,T)=>{var m,_,x,a,N,O,y,w,E,F,U,M,s,r,S,q,W,k,z,Q,X,Z,H,K,$,ee,le,se,te,ne,re,ue,oe,me,ce,ie,pe,be,ge,fe,ae;t.debug(e);const h=(m=e.access.insert)==null?void 0:m.some(n=>n.toUpperCase()==="POST"),P=(_=e.access.update)==null?void 0:_.some(n=>n.toUpperCase()==="POST"),b=(x=e.access.delete)==null?void 0:x.some(n=>n.toUpperCase()==="POST");e.src=Ve(i,u),e.privs={select:!0,insert:h,update:P,delete:b};let l={};((O=(N=(a=e==null?void 0:e.settings)==null?void 0:a.ui)==null?void 0:N.global)==null?void 0:O.table)!==!1?(l=f({},L,(E=(w=(y=e==null?void 0:e.settings)==null?void 0:y.ui)==null?void 0:w.global)==null?void 0:E.table),(S=(r=(s=(M=(U=(F=e==null?void 0:e.settings)==null?void 0:F.ui)==null?void 0:U.global)==null?void 0:M.table)==null?void 0:s.table)==null?void 0:r.pagination)!=null&&S.rowsPerPage&&(l.table.pagination.rowsPerPage=[...e.settings.ui.global.table.table.pagination.rowsPerPage]),(Q=(z=(k=(W=(q=e==null?void 0:e.settings)==null?void 0:q.ui)==null?void 0:W.global)==null?void 0:k.table)==null?void 0:z.table)!=null&&Q.defaultOrderBy&&(l.table.defaultOrderBy=[...e.settings.ui.global.table.table.defaultOrderBy])):l=f({},L,{table:{transactions:{insert:h,update:P,delete:b},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(X=e==null?void 0:e.privs)==null?void 0:X.delete}}});const J=[];for(let n=0;n<e.columns.length;n++)J[n]=B(e.columns[n].column_name,e.table_labels[e.columns[n].column_name]??e.columns[n].column_name);const g=[];if(Array.isArray(l.columns)&&l.columns.length>0){for(let n=0;n<l.columns.length;n++){const V=_e(e,l.columns[n].columnName);V!==void 0?g.push(f({},J[V],l.columns[n])):g.push(f({},B(e.columns[n].column_name),l.columns[n]))}l.columns=g}else l.columns=J;l.table.largeTableSupport.saved===Ne.AUTO?l.table.largeTableSupport.actual=Ae(e):l.table.largeTableSupport.actual=l.table.largeTableSupport.saved,t.debug(l);let o={...Y};((K=(H=(Z=e==null?void 0:e.settings)==null?void 0:Z.ui)==null?void 0:H.global)==null?void 0:K.form)!==!1&&(o=f({},Y,(le=(ee=($=e==null?void 0:e.settings)==null?void 0:$.ui)==null?void 0:ee.global)==null?void 0:le.form));const C=[];for(let n=0;n<e.columns.length;n++)C[n]=G(e.columns[n].column_name,e.form_labels[e.columns[n].column_name]??e.columns[n].column_name);const d=[];if(Array.isArray(o.columns)&&o.columns.length>0){for(let n=0;n<o.columns.length;n++){const V=_e(e,o.columns[n].columnName);V!==void 0?d.push(f({},C[V],o.columns[n])):d.push(f({},G(o.columns[n].column_name),o.columns[n]))}o.columns=d}else o.columns=C;const D=De.getSelectors().selectSelected(Ie.getState().explorer);t.debug("selected",D),D&&D[i]==="wp"&&((te=(se=e==null?void 0:e.settings)==null?void 0:se.wp)==null?void 0:te.tables)!==void 0&&Array.isArray(e.settings.wp.tables)&&e.settings.wp.tables.includes(u)&&(o.form={...xe},o.form.preserveSpacesOnUpdate=!0);let I={};if(((ue=(re=(ne=e==null?void 0:e.settings)==null?void 0:ne.ui)==null?void 0:re.global)==null?void 0:ue.theme)!==void 0&&((ce=(me=(oe=e==null?void 0:e.settings)==null?void 0:oe.ui)==null?void 0:me.global)==null?void 0:ce.theme)!==null&&((be=(pe=(ie=e==null?void 0:e.settings)==null?void 0:ie.ui)==null?void 0:pe.global)==null?void 0:be.theme)!=="")try{I=JSON.parse((ae=(fe=(ge=e==null?void 0:e.settings)==null?void 0:ge.ui)==null?void 0:fe.global)==null?void 0:ae.theme)}catch(n){t.error("Invalid JSON - theme settings"),t.error(n)}I===!1&&(I={});const p=f({},Je,I);return j(e,l,o,p,T===!0)},ye=(i,u,e,T,h,P)=>{var E,F,U,M;t.debug(i,u,e,T,h);const b=u.app.app[0];t.debug(b);const l=u.app.container[0];t.debug(l);let J={};try{J=JSON.parse(b.app_settings)}catch(s){t.error("Invalid JSON - app settings"),t.error(s)}t.debug(J);let g={};try{g=JSON.parse(l.cnt_cls)}catch(s){t.error("Invalid JSON - app columns"),t.error(s)}t.debug(g);const o=b.app_type,C=Number(o)===A.DATAENTRY||Number(o)===A.MASTERDETAIL||Number(o)===A.REGISTRATION,d=Number(o)===A.DATAENTRY||Number(o)===A.MASTERDETAIL||Number(o)===A.REGISTRATION||Number(o)===A.UPDATEFORM,D=Number(o)===A.DATAENTRY||Number(o)===A.MASTERDETAIL||Number(o)===A.REGISTRATION;t.debug(C,d,D),u.src=Me(i,l.cnt_id),u.privs={select:!0,insert:C,update:d,delete:D};const I=f({},L,{table:{transactions:{insert:C,update:d,delete:D},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(E=u==null?void 0:u.privs)==null?void 0:E.delete}}});t.debug(I);let p={};if(l.cnt_table!==void 0&&l.cnt_table!==null&&l.cnt_table!=="")try{p=JSON.parse(l.cnt_table)}catch(s){t.error("Invalid JSON - table settings"),t.error(s)}t.debug(p);const m=f({},I,p);(U=(F=p==null?void 0:p.table)==null?void 0:F.pagination)!=null&&U.rowsPerPage&&(m.table.pagination.rowsPerPage=[...p.table.pagination.rowsPerPage]),(M=p==null?void 0:p.table)!=null&&M.defaultOrderBy&&(m.table.defaultOrderBy=[...p.table.defaultOrderBy]),t.debug(m);const _=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&_.push(B(g[s].columnName,u.table_labels[g[s].columnName]??g[s].columnName,!0));if(t.debug(_),Array.isArray(m.columns)&&m.columns.length>0){const s=[];for(let r=0;r<m.columns.length;r++)if(m.columns[r].computedField!==void 0)s.push(f({},B(m.columns[r].columnName),m.columns[r]));else{const S=he(_,m.columns[r].columnName);S!==void 0&&s.push(f({},_[S],m.columns[r]))}_.map(r=>{s.filter(S=>S.columnName===r.columnName).length===0&&s.push(r)}),t.debug(s),m.columns=s}else m.columns=_;if(m.table.largeTableSupport.saved===Ne.AUTO?m.table.largeTableSupport.actual=Ae(u):m.table.largeTableSupport.actual=m.table.largeTableSupport.saved,(u==null?void 0:u.isRelationSelectionTable)===!0&&(p==null?void 0:p.columns)!==void 0&&Array.isArray(p.columns)){const s=[];p.columns.map(r=>{if(r.columnName.startsWith(Te.relationTablePrefix)){const S={...r};S.columnName=r.columnName.substring(Te.relationTablePrefix.length),s.push(S)}}),m.columns=[...s]}t.debug(m);let x={};if((l==null?void 0:l.cnt_form)!==void 0&&(l==null?void 0:l.cnt_form)!==null&&(l==null?void 0:l.cnt_form)!==""||u.useRform===!0&&(l==null?void 0:l.cnt_rform)!==void 0&&(l==null?void 0:l.cnt_rform)!==null&&(l==null?void 0:l.cnt_rform)!=="")try{u.useRform===!0?x=JSON.parse(l.cnt_rform):x=JSON.parse(l.cnt_form)}catch(s){t.error("Invalid JSON - form settings"),t.error(s)}t.debug(x);const a=f({},Y,x);t.debug(a);const N=[];for(let s=0;s<g.length;s++)g[s].isSelected===!0&&N.push(G(g[s].columnName,u.form_labels[g[s].columnName]??g[s].columnName,!0));if(t.debug(N),Array.isArray(a.columns)&&a.columns.length>0){const s=[];for(let r=0;r<a.columns.length;r++)if(a.columns[r].computedField!==void 0)s.push(f({},N[r],a.columns[r]));else{const S=he(N,a.columns[r].columnName);S!==void 0&&s.push(f({},N[S],a.columns[r]))}N.map(r=>{s.filter(S=>S.columnName===r.columnName).length===0&&s.push(r)}),a.columns=s}else a.columns=N;t.debug(a);let O={};if((b==null?void 0:b.app_theme)!==void 0&&(b==null?void 0:b.app_theme)!==null&&(b==null?void 0:b.app_theme)!=="")try{O=JSON.parse(b.app_theme)}catch(s){t.error("Invalid JSON - theme settings"),t.error(s)}O===!1&&(O={}),t.debug(O),h!==void 0&&(u.appRootId=h);let y={};if((l==null?void 0:l.cnt_chart)!==void 0&&(l==null?void 0:l.cnt_chart)!==null&&(l==null?void 0:l.cnt_chart)!=="")try{y=JSON.parse(l.cnt_chart)}catch(s){t.error("Invalid JSON - chart settings"),t.error(s)}y===!1&&(y={}),t.debug(y);const w=f({},Ce,y);return t.debug(w),v(de({appId:c,chartState:w})),j(u,m,a,O,e===!0,P)},ve=(i,u)=>{t.debug(i);const e=i.app.app[0];t.debug(e);let T={};try{T=JSON.parse(e.app_settings)}catch(h){t.error("Invalid JSON - app settings"),t.error(h)}return t.debug(T),v(Pe({appId:c,apps:i.app.apps,titles:i.app.titles,appSettings:T})),v(Se({appId:c,metaData:{...i,isExploring:u??!1}})),!0},j=(i,u,e,T,h,P)=>(t.debug(i),v(Se({appId:c,metaData:{...i}})),v(Re({appId:c,tableState:u,tableAccess:{insert:i.privs.insert,update:i.privs.update,delete:i.privs.delete},isView:we(i),exploring:h})),v(Ee({appId:c,formState:e})),v(Fe({appId:c,themeState:T})),P!==void 0&&P(),!0);return{prepareAdminStore:Oe,prepareAppStore:ye,prepareApp:ve}};var Be=(c=>(c[c.ADMIN=0]="ADMIN",c[c.APP=1]="APP",c))(Be||{});export{Me as D,Be as S,Ge as u};
