import{j as r}from"./cm-1.0.35--NMEhA6K.js";import{r as _}from"./redux-1.0.35-xa1uZ5t4.js";import{l as t,cc as R,C as k,K as w,bB as T,cg as E}from"./lib-1.0.35-vCbYWOI3.js";import{a as H}from"./RestApi-1.0.35-Bt-tzntO.js";import{c as z,d as C,e as K,f as U,g as $}from"./index-1.0.35-DHBDMhlb.js";import{M as q}from"./index.esm-1.0.35-BcBy0Voo.js";import"./useTheme-1.0.35-DvysJ9Pk.js";import{B as D}from"./Spinner-1.0.35-Dd1TcgqP.js";import{F as M,a as G}from"./FormHelperText-1.0.35-BubqYRHL.js";import{B as S}from"./cjs-1.0.35-B75n3jry.js";import"./vendor-1.0.35-CN03Eozo.js";import"./loglevel-1.0.35-BZ7XahX3.js";import"./lodash-1.0.35-CNe2eGU5.js";import"./moment-1.0.35-C5S46NFB.js";import"./iconBase-1.0.35-CEh1aNes.js";import"./Typography-1.0.35-DmbWmVEH.js";import"./useEnhancedEffect-1.0.35-gtlBTowv.js";import"./index-1.0.35-CCys4hnd.js";import"./useFormControl-1.0.35-gKEqvAy-.js";import"./notistack-1.0.35-C7EWtXAA.js";const Q="Upload or select %s from your WordPress media library",ge=({appId:f,columnName:o,columnValue:x,columnMetaData:m,onColumnChange:h,columnMedia:u,mediaType:d,locale:I,language:X,formMode:y,storeColumn:a,storeTable:N})=>{t.debug(f,o,x,m,u,d);const A=_.useRef(null),F=H(),B=_.useMemo(()=>q,[]),v=e=>{if(t.debug(e),e!=null&&e.id&&(e!=null&&e.url)&&(e!=null&&e.mime)&&(e!=null&&e.title))return{value:e.id,media:{url:e.url,mime_type:e.mime,title:e.title}}},V=()=>{t.debug("update media");const e=T(m.data_type)!=="number";t.debug(e);let s="media",n="";switch(d){case"WP-Image":s="images(s)",n="image";break;case"WP-Audio":s="audio",n="audio";break;case"WP-Video":s="video(s)",n="video";break}t.debug(s,n);const p=window.wp.media({title:Q.replace("%s",s),button:{text:"Select"},library:{type:n},multiple:e,render:!1});t.debug("frame",p),p.on("select",function(){const l=[];if(e){const i=p.state().get("selection").toJSON();t.debug(i),i.map(W=>{t.debug(W);const P=v(W);P&&l.push(P)})}else{const i=v(p.state().get("selection").first().toJSON());i&&l.push(i)}t.debug("media",l);const c=[],g=[];for(let i=0;i<l.length;i++)c.push(l[i].value),g.push(JSON.stringify(l[i].media));t.debug(c,g),h(o,c.toString()),F(E({appId:f,columnName:o,columnValue:g}))}),p.open(),N.formModal&&window.document.body.classList.add("pp-media-modal")},J=()=>{t.debug("delete media"),h(o,null),F(E({appId:f,columnName:o,columnValue:[]}))},L=e=>{switch(d){case"WP-Image":return r.jsx("img",{src:e.url,title:e.title,alt:e.title});case"WP-Attachment":{const s=e.mime_type.split("/");return r.jsxs("a",{href:e.url,title:e.title,target:"_blank",className:"pp-hyperlink",children:[r.jsxs("div",{children:[s[0]==="image"&&r.jsx(z,{}),s[0]==="audio"&&r.jsx(C,{}),s[0]==="video"&&r.jsx(K,{}),s[0]==="application"?s[1]==="pdf"?r.jsx(U,{}):r.jsx($,{}):r.jsx(r.Fragment,{})]}),r.jsx("div",{className:"link-label",children:e.title})]})}case"WP-Audio":return r.jsx("audio",{controls:!0,children:r.jsx("source",{src:e.url,type:e.mime_type})});case"WP-Video":return r.jsx("video",{controls:!0,children:r.jsx("source",{src:e.url,type:e.mime_type})})}};return r.jsxs("fieldset",{className:`pp-fieldset media ${d}`,children:[r.jsx("legend",{children:m.formLabel}),r.jsxs(D,{children:[r.jsxs(M,{fullWidth:!0,children:[u==null?void 0:u.map(e=>{try{if(e===null||e==="")return null;const s=JSON.parse(e);return s!=null&&s.url?r.jsx("div",{ref:A,className:"content",children:L(s)},s.url):null}catch(s){return t.error("Invalid media properties",s),r.jsx("span",{children:"Error reading media"})}}),r.jsx("input",{type:"hidden",value:x??""})]}),a.hint&&a.hint.trim()!==""&&r.jsx(M,{sx:{marginTop:"20px"},children:r.jsx(G,{sx:{marginLeft:0},children:R(a,"")})})]}),r.jsxs("div",{className:"actions",children:[r.jsx(S,{variant:"outlined",onClick:V,disabled:!k.appPlugin||y===w.VIEW||a.updatable===!1,children:B.select}),r.jsx(S,{variant:"outlined",onClick:J,disabled:!k.appPlugin||y===w.VIEW||a.updatable===!1,children:I.delete})]})]})};export{ge as default};
